{"title":"Extreme Learning Machine","markdown":{"yaml":{"title":"Extreme Learning Machine","author":"Simon-Pierre Boucher","date":"2023-02-11","categories":["R","Code","Extreme Learning Machine"],"image":"https://www.clipartmax.com/png/middle/124-1248944_the-future-of-ai-artificial-intelligence-logo.png"},"headingText":"one variable, complex function -------------------------------------------","containsRefs":false,"markdown":"\n\n```{r}\nelm <- function(X, y, n_hidden=NULL, active_fun=tanh) {\n  # X: an N observations x p features matrix\n  # y: the target\n  # n_hidden: the number of hidden nodes\n  # active_fun: activation function\n  pp1 = ncol(X) + 1\n  w0 = matrix(rnorm(pp1*n_hidden), pp1, n_hidden)       # random weights\n  h = active_fun(cbind(1, scale(X)) %*% w0)             # compute hidden layer\n  B = MASS::ginv(h) %*% y                               # find weights for hidden layer\n  fit = h %*% B                                         # fitted values\n  list(fit= fit, loss=crossprod(fit - y), B=B, w0=w0)\n}\n\n\n\nlibrary(tidyverse); library(mgcv)\nset.seed(123)\nn = 5000\nx = runif(n)\n# x = rnorm(n)\nmu = sin(2*(4*x-2)) + 2*exp(-(16^2)*((x-.5)^2))\ny = rnorm(n, mu, .3)\n# qplot(x, y)\nd = data.frame(x,y) \n\nX_ = as.matrix(x, ncol=1)\n\ntest = elm(X_, y, n_hidden=100)\nstr(test)\n# qplot(x, y) + geom_line(aes(y=test$fit), color='#1e90ff')\ncor(test$fit[,1], y)^2\n\ngam_comparison = gam(y~s(x))\nsummary(gam_comparison)$r.sq\n\n\nd %>% \n  mutate(fit_elm = test$fit,\n         fit_gam = fitted(gam_comparison)) %>% \n  ggplot() + \n  geom_point(aes(x, y), alpha=.1) +\n  geom_line(aes(x, y=fit_elm), color='#1e90ff') + \n  geom_line(aes(x, y=fit_gam), color='darkred')\n\n\n\n\n# motorcycle accident data ------------------------------------------------\n\ndata('mcycle', package='MASS')\nx = mcycle[,1]\nX_ = matrix(x, ncol=1)\ny = mcycle[,2]\n\ntest = elm(X_, y, n_hidden=100)\ncor(test$fit[,1], y)^2\n\ngam_comparison = gam(y~s(x))\nsummary(gam_comparison)$r.sq\n\nqplot(x, y) +\n  geom_line(aes(y=test$fit), color='#1e90ff') + \n  geom_line(aes(y=fitted(gam_comparison)), color='darkred')\n\n\n\n\n# add covariates ----------------------------------------------------------\n\nd = gamSim(eg=7, n=10000)\nX_ = as.matrix(d[,2:5])\ny = d[,1]\n\nn_nodes = c(10, 25, 100, 250, 500, 1000)\ntest = lapply(n_nodes, function(n) elm(X_, y, n_hidden=n))       # this will take a few seconds\nfinal_n = which.min(sapply(test, function(x) x$loss))\nbest = test[[final_n]]\n# str(best)\nqplot(best$fit[,1], y, alpha=.2)\ncor(best$fit[,1], y)^2\n\ngam_comparison = gam(y~s(x0) + s(x1) + s(x2) + s(x3), data=d)\ngam.check(gam_comparison)\nsummary(gam_comparison)$r.sq\n\n\ntest_data0 = gamSim(eg=7)  # default n = 400\ntest_data =  cbind(1, scale(test_data0[,2:5]))\n\nelm_prediction = tanh(test_data %*% best$w0) %*% best$B          # remember to use your specific activation function here\ngam_prediction = predict(gam_comparison, newdata=test_data0)\ncor(data.frame(elm_prediction, gam_prediction), test_data0$y)^2\n```\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"output-file":"index.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.269","editor":"visual","theme":"cosmo","title-block-banner":true,"title":"Extreme Learning Machine","author":"Simon-Pierre Boucher","date":"2023-02-11","categories":["R","Code","Extreme Learning Machine"],"image":"https://www.clipartmax.com/png/middle/124-1248944_the-future-of-ai-artificial-intelligence-logo.png"},"extensions":{"book":{"multiFile":true}}}}}