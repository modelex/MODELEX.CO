"0","elm <- function(X, y, n_hidden=NULL, active_fun=tanh) {"
"0","  # X: an N observations x p features matrix"
"0","  # y: the target"
"0","  # n_hidden: the number of hidden nodes"
"0","  # active_fun: activation function"
"0","  pp1 = ncol(X) + 1"
"0","  w0 = matrix(rnorm(pp1*n_hidden), pp1, n_hidden)       # random weights"
"0","  h = active_fun(cbind(1, scale(X)) %*% w0)             # compute hidden layer"
"0","  B = MASS::ginv(h) %*% y                               # find weights for hidden layer"
"0","  fit = h %*% B                                         # fitted values"
"0","  list(fit= fit, loss=crossprod(fit - y), B=B, w0=w0)"
"0","}"
"0",""
"0",""
"0",""
"0","# one variable, complex function -------------------------------------------"
"0","library(tidyverse); library(mgcv)"
"2","Le chargement a nécessité le package : nlme
"
"2","
Attachement du package : ‘nlme’

"
"2","L'objet suivant est masqué depuis ‘package:dplyr’:

    collapse

"
"2","This is mgcv 1.8-41. For overview type 'help(""mgcv-package"")'.
"
"2","
Attachement du package : ‘mgcv’

"
"2","L'objet suivant est masqué depuis ‘package:pracma’:

    magic

"
"0","set.seed(123)"
"0","n = 5000"
"0","x = runif(n)"
"0","# x = rnorm(n)"
"0","mu = sin(2*(4*x-2)) + 2*exp(-(16^2)*((x-.5)^2))"
"0","y = rnorm(n, mu, .3)"
"0","# qplot(x, y)"
"0","d = data.frame(x,y) "
"0",""
"0","X_ = as.matrix(x, ncol=1)"
"0",""
"0","test = elm(X_, y, n_hidden=100)"
"0","str(test)"
"1","List"
"1",""
"1"," of "
"1",""
"1","4"
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","fit "
"1",""
"1",":"
"1"," num [1:5000, 1] "
"1",""
"1","-1.0239 0.7311 -0.413 0.0806 -0.4112"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","loss"
"1",""
"1",":"
"1"," num [1, 1] "
"1",""
"1","442"
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","B   "
"1",""
"1",":"
"1"," num [1:100, 1] "
"1",""
"1","217 -608 1408 -1433 -4575"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","w0  "
"1",""
"1",":"
"1"," num [1:2, 1:100] "
"1",""
"1","0.35 0.814 -0.517 -2.692 -1.097"
"1",""
"1"," ..."
"1",""
"1","
"
"0","# qplot(x, y) + geom_line(aes(y=test$fit), color='#1e90ff')"
"0","cor(test$fit[,1], y)^2"
"1","[1]"
"1"," 0.8862518"
"1","
"
"0","gam_comparison = gam(y~s(x))"
"0","summary(gam_comparison)$r.sq"
"1","[1]"
"1"," 0.8482127"
"1","
"
"0","d %>% "
"0","  mutate(fit_elm = test$fit,"
"0","         fit_gam = fitted(gam_comparison)) %>% "
"0","  ggplot() + "
"0","  geom_point(aes(x, y), alpha=.1) +"
"0","  geom_line(aes(x, y=fit_elm), color='#1e90ff') + "
"0","  geom_line(aes(x, y=fit_gam), color='darkred')"
