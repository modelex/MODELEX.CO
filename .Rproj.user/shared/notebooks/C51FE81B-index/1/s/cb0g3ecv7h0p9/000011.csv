"0",""
"0",""
"0",""
"0","#' # Add alternately data shift"
"0",""
"0","#' This data includes a shift of the previous data."
"0",""
"0","set.seed(1234)"
"0",""
"0","n2   = 1000"
"0","x1.2 = rnorm(n2)"
"0","x2.2 = rnorm(n2)"
"0","y2 = -1 + .25*x1.2 - .25*x2.2 + rnorm(n2)"
"0","X2 = rbind(X, cbind(1, x1.2, x2.2))"
"0","coef2 = coef(lm(y2 ~ x1.2 + x2.2))"
"0","y2 = c(y, y2)"
"0",""
"0","n3    = 1000"
"0","x1.3  = rnorm(n3)"
"0","x2.3  = rnorm(n3)"
"0","y3    = 1 - .25*x1.3 + .25*x2.3 + rnorm(n3)"
"0","coef3 = coef(lm(y3 ~ x1.3 + x2.3))"
"0",""
"0","X3 = rbind(X2, cbind(1, x1.3, x2.3))"
"0","y3 = c(y2, y3)"
"0",""
"0",""
"0",""
"0","#' ## Run"
"0",""
"0",""
"0","sgd_result2 = sgd("
"0","  init,"
"0","  X = X3,"
"0","  y = y3,"
"0","  stepsize = 1,"
"0","  stepsizeTau = 0,"
"0","  average = FALSE"
"0",")"
"0",""
"0","str(sgd_result2)"
"1","List"
"1",""
"1"," of "
"1",""
"1","5"
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","par   "
"1",""
"1",":"
"1"," num [1:3, 1] "
"1",""
"1","0.821 -0.223 0.211"
"1",""
"1","
"
"1","  .."
"1",""
"1","- attr(*, ""dimnames"")="
"1","List"
"1",""
"1"," of "
"1",""
"1","2"
"1",""
"1","
"
"1","  .. .."
"1",""
"1","$ "
"1",""
"1",""
"1",""
"1",":"
"1"," chr [1:3] "
"1",""
"1","""Intercept"" ""x1"" ""x2"""
"1",""
"1","
"
"1","  .. .."
"1",""
"1","$ "
"1",""
"1",""
"1",""
"1",":"
"1"," NULL
"
"1"," "
"1",""
"1","$ "
"1",""
"1","parvec"
"1",""
"1",":"
"1"," num [1:3000, 1:3] "
"1",""
"1","-1 -0.119 0.624 1.531 1.063"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","loss  "
"1",""
"1",":"
"1"," num [1:3000] "
"1",""
"1","0.67 2.31 3.69 30.99 10.58"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","RMSE  "
"1",""
"1",":"
"1"," num "
"1",""
"1","1.57"
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","fitted"
"1",""
"1",":"
"1"," num [1:3000] "
"1",""
"1","0 -0.421 -0.797 -4.421 2.952"
"1",""
"1"," ..."
"1",""
"1","
"
"0","#' Compare with `lm` for each data part."
"0","#' "
"0","sgd_result2$parvec[c(n, n + n2, n + n2 + n3), ]"
"1","    "
"1","       [,1]"
"1","       [,2]"
"1","       [,3]"
"1","
[1,]"
"1","  1.0859378"
"1","  0.5128904"
"1","  0.1457697"
"1","
[2,]"
"1"," -0.9246994"
"1","  0.2945723"
"1"," -0.2941759"
"1","
[3,]"
"1","  0.8213521"
"1"," -0.2229918"
"1","  0.2112883"
"1","
"
"0","rbind(coef1, coef2, coef3)"
"1","     "
"1"," (Intercept)"
"1","         x1"
"1","         x2"
"1","
coef1"
"1","   1.0299573"
"1","  0.5177020"
"1","  0.1631026"
"1","
coef2"
"1","  -0.9700427"
"1","  0.2677020"
"1"," -0.2868974"
"1","
coef3"
"1","   1.0453166"
"1"," -0.2358521"
"1","  0.2418489"
"1","
"
"0","#' Visualize estimates."
"0","#' "
"0","gd = data.frame(sgd_result2$parvec) %>% "
"0","  mutate(Iteration = 1:n())"
"0",""
"0","gd = gd %>% "
"0","  pivot_longer(cols = -Iteration,"
"0","               names_to = 'Parameter', "
"0","               values_to = 'Value') %>% "
"0","  mutate(Parameter = factor(Parameter, labels = colnames(X)))"
"0",""
"0",""
"0","ggplot(aes(x = Iteration,"
"0","           y = Value,"
"0","           group = Parameter,"
"0","           color = Parameter"
"0","           ),"
"0","       data = gd) +"
"0","  geom_path() +"
"0","  geom_point(data = filter(gd, Iteration %in% c(n, n + n2, n + n2 + n3)),"
"0","             size = 3) +"
"0","  geom_text("
"0","    aes(label = round(Value, 2)),"
"0","    hjust = -.5,"
"0","    angle = 45,"
"0","    data = filter(gd, Iteration %in% c(n, n + n2, n + n2 + n3)),"
"0","    size = 4,"
"0","    show.legend = FALSE"
"0","  ) +"
"0","  theme_minimal()"
"0",""
